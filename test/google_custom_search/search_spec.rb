require '../spec_helper'

describe GoogleCustomSearch::Search do

  MOCK_JSON = {"responseData"=>{"results"=>[{"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx%3FperformanceNumber%3D17303", "cacheUrl"=>"http://www.google.com/search?q=cache:pGjUcr1qUkgJ:www.culturaldistrict.org", "content"=>"Ode to Joy Ode to Joy. Presented by: Pittsburgh Symphony Part of BNY Mellon   Grand Classics Venue: Heinz Hall. Inspired by a dazzling garden in Scotland <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx?performanceNumber=17303", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/tickets/reserve.aspx%3FperformanceNumber%3D21140", "cacheUrl"=>"http://www.google.com/search?q=cache:E5_VPQiQo3kJ:www.culturaldistrict.org", "content"=>"This performance of &quot;Tribute&quot;-A Symphonic Celeb is currently not available   online. Online availability for some performances may change if you login. <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/tickets/reserve.aspx?performanceNumber=21140", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx%3FperformanceNumber%3D23379", "cacheUrl"=>"http://www.google.com/search?q=cache:V7cn6Foe2rMJ:www.culturaldistrict.org", "content"=>"Zany Umbrella Circus Zany Umbrella Circus. Presented by: Pittsburgh   International Children&#39;s Theater Venue: The Charity Randall Theatre <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx?performanceNumber=23379", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx%3FperformanceNumber%3D17350", "cacheUrl"=>"http://www.google.com/search?q=cache:fJurfpC17DYJ:www.culturaldistrict.org", "content"=>"Rite of Spring Rite of Spring. Presented by: Pittsburgh Symphony Part of BNY   Mellon Grand Classics Venue: Heinz Hall <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx?performanceNumber=17350", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx%3FperformanceNumber%3D23374", "cacheUrl"=>"http://www.google.com/search?q=cache:jExxaBgeDD0J:www.culturaldistrict.org", "content"=>"Aga-Boom Aga-Boom. Presented by: Pittsburgh International Children&#39;s Theater   Venue: The Charity Randall Theatre. Jump headfi rst into a chain reaction of <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx?performanceNumber=23374", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx%3FperformanceNumber%3D17353", "cacheUrl"=>"http://www.google.com/search?q=cache:h43Ggs_qthYJ:www.culturaldistrict.org", "content"=>"Hahn &amp; Shostakovich Hahn &amp; Shostakovich. Presented by: Pittsburgh Symphony Part   of BNY Mellon Grand Classics Venue: Heinz Hall <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/tickets/production.aspx?performanceNumber=17353", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District", "url"=>"http://www.culturaldistrict.org/tickets/calendar/", "cacheUrl"=>"http://www.google.com/search?q=cache:cI47PY7ITc4J:www.culturaldistrict.org", "content"=>"Not finding what you&#39;re looking for? Try Ticket Search ¬ª. View: May 2010, June   2010, July 2010, August 2010, September 2010, October 2010, November 2010 <b>...</b>", "visibleUrl"=>"www.culturaldistrict.org", "unescapedUrl"=>"http://www.culturaldistrict.org/tickets/calendar/", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District"}, {"GsearchResultClass"=>"GwebSearch", "title"=>"Pittsburgh&#39;s Cultural District - Your Show Place!", "url"=>"http://culturaldistrict.org/%3Fop%3Dcontact", "cacheUrl"=>"http://www.google.com/search?q=cache:UUq_Mw_-UnIJ:culturaldistrict.org", "content"=>"Art &middot; Blonde, Brunette, Redhead &middot; Nunsense. To see performances coming up this   weekend click here. Purchase Cultural District Gift Cards.", "visibleUrl"=>"culturaldistrict.org", "unescapedUrl"=>"http://culturaldistrict.org/?op=contact", "titleNoFormatting"=>"Pittsburgh&#39;s Cultural District - Your Show Place!"}], "cursor"=>{"estimatedResultCount"=>"409", "currentPageIndex"=>3, "moreResultsUrl"=>"http://www.google.com/cse?oe=utf8&ie=utf8&source=uds&cx=004905679161489350096%3Arymp5afccji&start=28&hl=en&q=org", "pages"=>[{"label"=>1, "start"=>"0"}, {"label"=>2, "start"=>"8"}, {"label"=>3, "start"=>"16"}, {"label"=>4, "start"=>"24"}, {"label"=>5, "start"=>"32"}, {"label"=>6, "start"=>"40"}, {"label"=>7, "start"=>"48"}, {"label"=>8, "start"=>"56"}]}, "context"=>{"title"=>"Cultural District Search Engine", "facets"=>[]}}, "responseDetails"=>nil, "responseStatus"=>200}

  GoogleCustomSearch::Search.google_search_api_key = "abcd"

  describe "for" do

    it "should return the estimated results count for the given search" do
      mock_uri = mock(URI)
      mock_uri.should_receive(:read).and_return(MOCK_JSON.to_json)
      URI.should_receive(:parse).with("http://ajax.googleapis.com/ajax/services/search/web?v=1.0&oe=utf8&ie=utf8&source=uds&hl=en&rsz=large&cx=abcd&q=org").and_return(mock_uri)
      search = GoogleCustomSearch::Search.new
      results = search.for("org")
      results.estimated_count.should == 409

    end

  end

end